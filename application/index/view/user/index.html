
{include file="public/head" isMember="1" /}

<script type="text/javascript" src="/assets/static/script/Validform_v5.3.2_min.js"></script>
<div class="common-member-wrap">
    <div class="wp1200">
        <div class="c--wrap clearfloat">

            {include file="public/member_left_nav" /}

            <div class="c--member-right-wrap">
                <div class="member-wrap">
                    <div class="user-wrap clearfloat">
                        <div class="avatar-box"><img src="{if !empty($user.avatar)}{$user.avatar}{else}/assets/img/avatar.png{/if}" alt=""></div>
                        <div class="user-info-box">
                            <div class="username">
                                <span class="user-txt">{$user.nickname}</span>
                                {if isset($enterprise_level)}
                                {switch name="enterprise_level"}
                                {case value="王者"}<img src="/assets/static/images/level/level_4.png" class="level-img" alt="">{/case}
                                {case value="钻石"}<img src="/assets/static/images/level/level_3.png" class="level-img" alt="">{/case}
                                {case value="黄金"}<img src="/assets/static/images/level/level_2.png" class="level-img" alt="">{/case}
                                {/switch}
                                {/if}
                                <div class="id-00">ID：{$user.no}</div>
                            </div>
                            <div class="mobile">
                                <span class="num-box">手 机：{$user.mobile}</span>
                                <a href="javascript:;" class="modify">
                                    <img src="/assets/static/images/beizhu.png" class="beizhu-icon" alt="">
                                    <span class="mobile-txt">更改手机</span>
                                </a>
                            </div>
                            <div class="money">
                                <span class="money-txt">金 豆：</span>
                                <p>共 <span class="orange-gold orange_gold">***</span> 豆，可提现 <span class="orange-money">**</span> 元</p>
                                <a href="#" class="money-btn" id="checkBtn">查看金豆 >></a>
                                <a href="{:url('/user/formula')}" class="money-btn">投稿赚金豆 >></a>
                                <a href="{:url('/user/getBillList')}" class="money-btn">查看账单明细 >></a>
                            </div>
                            <div class="money">
                                <span class="money-txt">金 币：</span>
                                <p>共 <span class="orange-gold">{$user.points}</span> 币</p>
                            </div>
                            <div class="level-time">
                                <div class="lt-box">
                                    <span class="lt-txt">专家等级：</span>
                                    <span class="lt--txt">{if isset($expert_level)}{$expert_level}{/if}</span>
                                </div>
                                <div class="lt-box">
                                    <span class="lt-txt">有效期：</span>
                                    <span class="lt-txt">{if isset($expert_time)}{$expert_time}{/if}</span>
                                </div>
                            </div>
                            <div class="level-time">
                                <div class="lt-box">
                                    <span class="lt-txt">企业等级：</span>
                                    <span class="lt--txt">{if isset($enterprise_level)}{$enterprise_level}{/if}</span>
                                </div>
                                <div class="lt-box">
                                    <span class="lt-txt">有效期：</span>
                                    <span class="lt-txt">{if isset($enterprise_time)}{$enterprise_time}{/if}</span>
                                </div>
                            </div>
                        </div>
                        <a href="{:url('/user/profile')}" class="triangle"><span class="triangle-txt">修改资料</span></a>
                    </div>
                    <ul class="tab-block clearfloat">
                        <li class="tab-list">
                            <a href="{:url('/user/myArticle')}" class="tab-item">
                                <img class="icon" src="/assets/static/images/member_icon1.png" alt="">
                                <div class="txt">
                                    <p class="b-txt">{$articleNum}</p>
                                    <p class="m-txt">我的配方</p>
                                </div>
                            </a>
                        </li>
                        <li class="tab-list">
                            <a href="{:url('/user/myAskquestion')}" class="tab-item">
                                <img class="icon" src="/assets/static/images/member_icon2.png" alt="">
                                <div class="txt">
                                    <p class="b-txt">{$onlineNum}</p>
                                    <p class="m-txt">我的咨询服务</p>
                                </div>
                            </a>
                        </li>
                        <li class="tab-list">
                            <a href="{:url('/user/purchase')}" class="tab-item">
                                <img class="icon" src="/assets/static/images/member_icon3.png" alt="">
                                <div class="txt">
                                    <p class="b-txt">{$purchaseNum}</p>
                                    <p class="m-txt">我的求购</p>
                                </div>
                            </a>
                        </li>
                        <li class="tab-list">
                            <a href="{:url('/user/supply')}" class="tab-item">
                                <img class="icon" src="/assets/static/images/member_icon4.png" alt="">
                                <div class="txt">
                                    <p class="b-txt">{$supplyNum}</p>
                                    <p class="m-txt">我的供应</p>
                                </div>
                            </a>
                        </li>
                    </ul>
                    <div class="instructions-wrap">
                        {if empty($user.verify_id)}
                        <p>填写 <a href="{:url('/user/idAuthentication')}">身份证号</a>，进行个人身份认证>>{$user.verify_id}  <a href="{:url('/index/user/formula')}" target="_blank">投稿配方</a>、 <a href="{:url('/index/user/knowledge')}" target="_blank">投稿知识库</a></p>
                        {else}
                        <p>查看 <a href="{:url('/user/idAuthentication')}">个人身份认证</a> 信息>>  <a href="{:url('/index/user/formula')}" target="_blank">投稿配方</a>、 <a href="{:url('/index/user/knowledge')}" target="_blank">投稿知识库</a></p>
                        {/if}
                        {if empty($user.enterprise_id)}
                        <p>立即完善 <a href="{:url('index/user/enterprise')}">企业信息</a>，可以发布供应信息！<a href="{:url('/index/user/supply')}" target="_blank">发布信息</a>、 <a href="{:url('/index/user/purchase')}" target="_blank">求购信息</a>、 <a href="{:url('/index/user/job_wanted')}" target="_blank">人才招聘</a></p>
                        {else}
                        <p>查看 <a href="{:url('index/user/enterprise')}">企业认证</a> 信息>> <a href="{:url('/index/user/supply')}" target="_blank">发布信息</a>、 <a href="{:url('/index/user/purchase')}" target="_blank">求购信息</a>、 <a href="{:url('/index/user/job_wanted')}" target="_blank">人才招聘</a></p>
                        {/if}
<!--                        <p>立即 <a href="#">企业认证</a>，为你的企业置顶首页，带来无限商机</p>-->
                        {if empty($user.expert_id)}
                        <p>立即 <a href="{:url('/user/expertApplication')}">成为专家</a>，为广大企业/用户解决更多难题，实现你的更大价值！<a href="{:url('/index/user/formula')}" target="_blank">投稿配方</a>、 <a href="{:url('/index/user/knowledge')}" target="_blank">投稿知识库</a></p>
                        {else}
                        <p>查看 <a href="{:url('/user/expertApplication')}">专家认证</a> 信息>> <a href="{:url('/index/user/formula')}" target="_blank">投稿配方</a>、 <a href="{:url('/index/user/knowledge')}" target="_blank">投稿知识库</a></p>
                        {/if}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-wrap check-card-wrap">
        <div class="check-card-content">
            <div class="modal-close"><i class="iconfont icon-fork"></i></div>
            <h2>验证身份</h2>
            <form action="" class="formId">
                <div class="form-row"><input type="text" name="number" class="inp" placeholder="请输入身份证后六位"></div>
                <div class="btn-box"><button type="button" class="btn btn-card">确认提交</button></div>
            </form>
        </div>
    </div>
    <div class="modal-wrap edit-phone-wrap">
        <div class="edit-phone-content">
            <div class="modal-close"><i class="iconfont icon-fork"></i></div>
            <h2>修改手机号</h2>
            <form id="form1" action="{:url('api/user/changemobile')}" method="post" class="formId">
                <div class="form-row">
                    <div class="input-box">
                        <input type="text" datatype="*,/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/" nullmsg="请填写手机" errormsg="手机格式错误" name="mobile" class="inp" placeholder="请输入新的手机号">
                    </div>
                    <a href="javascript:sendCode();" id="btn-code" class="get-yzm">获取验证码</a>
                </div>
                <div class="form-row">
                    <div class="input-box w100">
                        <input type="text" datatype="*" nullmsg="请填写短信验证码" name="captcha" class="inp" placeholder="请输入手机验证码">
                    </div>
                </div>
                <div class="btn-box"><button type="button" class="btn btn-mobile">确认提交</button></div>
            </form>
        </div>
    </div>
    <div class="bg" id="overlay"></div>
</div>
<script>
    $(function() {
        $('#checkBtn').on('click', function() {

            if ($(this).text() == '提现金豆 >>') {
                window.location.href = "{:url('/user/takecash')}";
                return false;
            }

            var verify = '{$user.verify_id}';
            if (!verify) {
                showmsg('请先完成个人身份认证', "{:url('/user/idAuthentication')}");
            } else {
                $('.check-card-wrap').addClass('md-show')
            }
        })
        $('.modify').on('click', function() {
            $('.edit-phone-wrap').addClass('md-show')
        })
        $('.modal-close').on('click', function() {
            $('.check-card-wrap').removeClass('md-show')
            $('.edit-phone-wrap').removeClass('md-show')
            $(':input', '.formId')
                .not(':button, :submit, :reset, :hidden')
                .val('')
                .removeAttr('checked')
                .removeAttr('selected');
        })

        $('.btn-card').click(function () {
            $.post('/user/getAmount', {number:$('input[name=number]').val()}, function (data) {
                if (data.code == 1) {
                    $('.orange_gold').html(data.data.gold);
                    $('.orange-money').html(data.data.amount);
                    $('.check-card-wrap').removeClass('md-show')
                    $('#checkBtn').text('提现金豆 >>')
                } else {
                    showmsg(data.msg);
                }
            })
        })

        $.Tipmsg.r = null;
        $('#form1').Validform({
            btnSubmit:".btn-mobile",
            tipSweep: true,
            ajaxPost:true,
            tiptype: function (msg, o, cssctl) {
                if (!o.obj.is("form")) {
                    var objtip = o.obj.siblings(".checktip");
                    cssctl(objtip, o.type);
                    showmsg(msg);
                    return false;
                }
            },
            callback:function(data){
                if (data.code == 1) {
                    showmsg('修改成功', 'refresh');
                } else {
                    showmsg('修改失败');
                }
            }
        });
    })

    function sendCode() {
        var mobile = $.trim($("input[name='mobile']").val());
        //手机验证
        var mobileStr = /^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/;
        if( mobile == '' ){
            alert("手机号码不能为空！");
            return false;
        }
        if( !mobileStr.test(mobile) ){
            alert("手机号码不正确！");
            return false;
        }

        $.post("{:url('api/sms/send')}", {mobile:mobile, event:'changemobile'}, function(result){
            if( result.code == 1 ){
                var obj = $("#btn-code");
                settime(obj);
            }
            showmsg(result.msg);
        });
    }

    //发送验证码倒计时
    var countdownNum = 60;
    function settime(obj) {
        console.log(countdownNum);
        if (countdownNum == 0) {
            obj.attr('disabled',false);
            obj.css("pointer-events","auto");
            obj.text("获取验证码");
            countdownNum = 60;
            return;
        } else {
            obj.attr('disabled',true);
            obj.css("pointer-events","none");
            obj.text("重新发送(" + countdownNum + ")");
            countdownNum--;
        }
        setTimeout(function(){
            settime(obj);
        },1000);
    }
</script>

{include file="public/footer"  /}

