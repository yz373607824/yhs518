{include file="public/head" isMember="0" /}

<script type="text/javascript" src="/assets/static/script/Validform_v5.3.2_min.js"></script>
    <div class="common-page-content">
        <div class="wp1200">
            <?php $banner = get_banner(20,1);?>
            {volist name='banner' id='item'}
            <a href="{$item.url}" target="_blank" class="article-banner-wrap">
                <img src="{$item.pic}" alt="{$item.name}">
            </a>
            {/volist}
            <div class="breadcrumb">
                <a href="/" class="min-logo">
                    <img src="/assets/static/images/min_logo.jpg" alt="">
                </a>
                <i class="iconfont icon-jiantouyou"></i>
                <a href="{:url('/channel/' . $__CHANNEL__.diyname)}" class="bread-hover">会员活动</a>
                <i class="iconfont icon-jiantouyou"></i>
                <a href="{:url('/archives/' . $__ARCHIVES__.id)}" class="bread-hover">{$__ARCHIVES__.title}</a>
            </div>
            <div class="member-activities-detail-wrap">
                <div class="inner-member-activities-detail">
                    <div class="article-wrap">
                        <div class="title-box">
                            <h2>{$__ARCHIVES__.title}</h2>
                            <h3>发表时间：{$__ARCHIVES__.publishtime|date="Y-m-d",###}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;浏览次数：{$__ARCHIVES__.views}</h3>
                        </div>
                        {$__ARCHIVES__.content|html_entity_decode}
                    </div>
                    <form id="form1" action="/diyform" method="post" class="form-wrap">
                        <input type="hidden" name="__diyname__" value="apply_online">
                        {:token('apply_online_token')}
                        <input type="hidden" name="backurl" value="{$Request.url}">
                        <h2>在线报名</h2>
                        <div class="row-wrap clearfloat">
                            <div class="input-block">
                                <div class="inner">
                                    <div class="txt-box">
                                        <span class="red-star">*</span>
                                        <span class="txt">姓 名：</span>
                                    </div>
                                    <input type="text" datatype="*" nullmsg="请填写姓名" name="row[name]" class="inp">
                                </div>
                            </div>
                            <div class="input-block">
                                <div class="inner">
                                    <div class="txt-box">
                                        <span class="red-star">*</span>
                                        <span class="txt">性 别：</span>
                                    </div>
                                    <input type="text" datatype="*" nullmsg="请填写性别" name="row[sex]" class="inp">
                                </div>
                            </div>
                        </div>
                        <div class="row-wrap clearfloat">
                            <div class="input-block">
                                <div class="inner">
                                    <div class="txt-box">
                                        <span class="red-star">*</span>
                                        <span class="txt">工作单位：</span>
                                    </div>
                                    <input type="text" datatype="*" nullmsg="请填写工作单位" name="row[company]" class="inp">
                                </div>
                            </div>
                            <div class="input-block">
                                <div class="inner">
                                    <div class="txt-box">
                                        <span class="red-star">*</span>
                                        <span class="txt">部门职位：</span>
                                    </div>
                                    <input type="text" datatype="*" nullmsg="请填写部门职位" name="row[department]" class="inp">
                                </div>
                            </div>
                        </div>
                        <div class="row-wrap clearfloat">
                            <div class="input-block">
                                <div class="inner">
                                    <div class="txt-box">
                                        <span class="red-star">*</span>
                                        <span class="txt">手机号码：</span>
                                    </div>
                                    <input type="text" datatype="*,/^[1](([3][0-9])|([4][5-9])|([5][0-3,5-9])|([6][5,6])|([7][0-8])|([8][0-9])|([9][1,8,9]))[0-9]{8}$/" nullmsg="请填写手机号码" errormsg="手机号码格式错误" name="row[phone]" class="inp">
                                </div>
                            </div>
                            <div class="input-block">
                                <div class="inner">
                                    <div class="txt-box">
                                        <span class="red-star">*</span>
                                        <span class="txt">邮箱：</span>
                                    </div>
                                    <input type="text" datatype="*,e" nullmsg="请填写邮箱" errormsg="邮箱格式错误" name="row[email]" class="inp">
                                </div>
                            </div>
                        </div>
                        <div class="row-wrap clearfloat">
                            <div class="input-block w100">
                                <div class="inner">
                                    <div class="txt-box">
                                        <span class="red-star">*</span>
                                        <span class="txt">联系地址：</span>
                                    </div>
                                    <input type="text" datatype="*" nullmsg="请填写联系地址" name="row[address]" class="inp">
                                </div>
                            </div>
                        </div>
                        <div class="row-wrap clearfloat">
                            <div class="input-block">
                                <div class="inner por">
                                    <div class="txt-box">
                                        <span class="txt">附件上传：</span>
                                    </div>
                                    <input type="text" readonly class="inp w50" id="filename">
                                    <input type="text" style="display: none;" name="row[file]" id="file">
                                    <a href="javascript:void(0)" class="js-file-btn">
                                        <input type="file">点击上传
                                    </a>
                                </div>
                            </div>
                            <div class="input-block">
                                <div class="inner fz0 bg0">
                                    <div class="inp-box" style="padding-right: 0px;">
                                        <div class="txt-box h100">
                                            <span class="red-star">*</span>
                                            <span class="txt">验证码：</span>
                                        </div>
                                        <input type="text" datatype="*" nullmsg="请填写验证码" name="captcha" class="inp">
                                    </div>
                                    <div class="yzm-box" style="padding-left: 0px;padding-right: 0px;"><img src="{:captcha_src()}" onclick="this.src = '{:captcha_src()}?r=' + Math.random();" alt="验证码没能获取到，请刷新重试"></div>
                                </div>
                            </div>
                        </div>
                        <div class="bfc">
                            <div class="sub-box">
                                <button>提 交</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(function() {
            var uploading = false;
            //上传附件
            $('.js-file-btn').on('change', 'input[type="file"]', function(e) {
                var file = e.currentTarget.files[0];
                if(uploading){
                    showmsg("文件正在上传中，请稍候");
                    return false;
                }
                var formdata = new FormData();
                formdata.append("file", file);
                $.ajax({
                    url: "/ajax/upload",
                    type: 'POST',
                    cache: false,
                    data: formdata,
                    processData: false,
                    contentType: false,
                    dataType:"json",
                    beforeSend: function(){
                        uploading = true;
                    },
                    success : function(result) {
                        if (result.code == 1) {
                            $("#filename").val(file.name);
                            $("#file").val(result.data.url);
                            showmsg(result.msg);
                        } else {
                            showmsg(result.msg);
                        }
                        uploading = false;
                    }
                });
            });

            $.Tipmsg.r = null;
            $('#form1').Validform({
                btnSubmit:".sub-box",
                tipSweep: true,
                ajaxPost:true,
                tiptype: function (msg, o, cssctl) {
                    if (!o.obj.is("form")) {
                        var objtip = o.obj.siblings(".checktip");
                        cssctl(objtip, o.type);
                        showmsg(msg);
                        return false;
                    }
                },
                callback:function(data){
                    if (data.code == 1) {
                        showmsg(data.msg, "{:url('/archives/' . $__ARCHIVES__.id)}")
                    } else {
                        if (data.url) {
                            showmsg(data.msg, data.url)
                        } else {
                            showmsg(data.msg)
                            $('input[name=apply_online_token]').val(data.data.token);
                            $('.yzm-box img').trigger('click');
                        }

                    }
                }
            });
        })

    </script>

{include file="public/footer"  /}